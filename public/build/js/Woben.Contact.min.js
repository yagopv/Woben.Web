var WobenContact=angular.module("WobenContact",["ui.router"]);WobenContact.config(["$stateProvider",function(a){a.state("contact",{url:"/contact",controller:"ContactController",templateUrl:"/app/templates/contact/contact.html"}).state("messageList",{url:"/dashboard/message/index",controller:"MessageListController",templateUrl:"/app/templates/contact/messageList.html",resolve:{User:["$state","accountService",function(a,b){return b.isUserInRole(["Administrator"]).then(function(a){return a},function(){a.go("signin")})}]}})}]),WobenContact.value("baseEndPoint","https://woben.azurewebsites.net"),WobenContact.factory("messageService",["$http","$q","$cacheFactory","baseEndPoint","$window",function(a,b,c,d){return{getAll:function(c){var e=b.defer();return a({method:"GET",url:d+"/odata/Message"+(c?"?"+c:""),cache:!0}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},getById:function(c){var e=b.defer();return a({method:"GET",url:d+"/odata/Message("+c+")"}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise},add:function(e){var f=b.defer(),g=d+"/odata/Message";return a({method:"POST",url:g,data:e}).success(function(a){c.get("$http").removeAll(),f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},update:function(e){var f=b.defer(),g=d+"/odata/Message("+e.messageId+")";return a({method:"PUT",url:g,data:e}).success(function(a){c.get("$http").removeAll(),f.resolve(a)}).error(function(a){f.reject(a)}),f.promise},"delete":function(c){var e=b.defer();return a({method:"DELETE",url:d+"/odata/Message("+c+")"}).success(function(a){e.resolve(a)}).error(function(a){e.reject(a)}),e.promise}}}]),WobenContact.controller("ContactController",["$scope","messageService","errorService",function(a,b,c){a.disabled=!1,a.showConfirmationMessage=!1,a.showNotificationMessage=!1,a.sendMessage=function(){a.disabled=!0,b.add(a.message).then(function(){a.disabled=!1,a.showConfirmationMessage=!0,a.showNotificationMessage=!0},function(b){a.disabled=!1,a.modelErrors=c.handleODataErrors(b)})},a.sendAnotherMessage=function(){a.showNotificationMessage=!1}}]),WobenContact.controller("MessageListController",["$scope","messageService","errorService","ngDialog",function(a,b,c,d){a.skip=0,a.top=10,a.noMore=!1,a.odataString="$skip="+a.skip+"&$top="+a.top,b.getAll(a.odataString).then(function(b){a.messages=b,a.skip=a.top},function(b){a.modelErrors=c.handleODataErrors(b)}),a.search=function(){a.skip=0,a.top=10,a.odataString=a.query&&""!=a.query?"$skip="+a.skip+"&$top="+a.top+"&$filter=substringof('"+a.query+"',CreatedBy) or substringof('"+a.query+"',PhoneNumber) or substringof('"+a.query+"',Name) or substringof('"+a.query+"',Email) or substringof('"+a.query+"',Text)&$orderby=CreatedDate desc":"$skip="+a.skip+"&$top="+a.top,b.getAll(a.odataString).then(function(b){a.noMore=!1,a.messages=b,a.skip=a.top},function(b){a.modelErrors=c.handleODataErrors(b)})},a.loadMore=function(){a.odataString="$skip="+a.skip+"&$top="+a.top,b.getAll(a.odataString).then(function(b){b.length>0&&angular.forEach(b,function(b){a.messages.push(b)}),b.length<a.top&&(a.noMore=!0),a.skip=a.skip+a.top},function(b){a.modelErrors=c.handleODataErrors(b)})},a.sureToDelete=function(b){a.messageToDelete=b,a.dialogMessage="¿Seguro que quieres eliminar esta notificación?",d.open({template:"/app/templates/common/dialogConfirmation.html",scope:a})},a.confirmAction=function(){b.delete(a.messageToDelete.messageId).then(function(){var b=a.messages.indexOf(a.messageToDelete);a.messages.splice(b,1)},function(b){a.modelErrors=c.handleODataErrors(b)})},a.checkMessage=function(b){a.messageDetail=b,d.open({template:"/app/templates/contact/messageDetail.html",scope:a})}}]);