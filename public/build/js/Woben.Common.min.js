var WobenCommon=angular.module("WobenCommon",["ui.router","angularFileUpload"]);WobenCommon.value("baseEndPoint","https://woben.azurewebsites.net"),WobenCommon.directive("woCheckbox",function(){return{link:function(a,b,c){var d=$(b).find("[data-toggle=checkbox]");d.checkbox(),"true"==a.value?(a.ngModel=!0,d.checkbox("check")):(a.ngModel=!1,d.checkbox("uncheck")),$(b).on("click",function(){return a.ngModel=!d.is(":checked"),d.checkbox(1==a.ngModel?"check":"uncheck"),a.$apply(),!1}),c.$observe("value",function(a){d.checkbox("true"==a?"check":"uncheck")})},restrict:"E",replace:!0,scope:{label:"@",value:"@",ngModel:"="},controller:function(){},templateUrl:"/app/templates/common/checkboxDirective.html"}}),WobenCommon.directive("woRadio",function(){return{link:function(a,b){var c=$(b).find(":radio");c.radio(),$(":radio").on("toggle",function(b){a.ngModel=$(b.target).val()})},scope:{ngModel:"="},restrict:"EAC"}}),WobenCommon.directive("woErrors",function(){return{restrict:"E",replace:!0,scope:{errors:"=",title:"@"},templateUrl:"/app/templates/common/errorDirective.html"}}),WobenCommon.factory("authInterceptor",["$rootScope","$q","$window",function(a,b,c){return{request:function(a){a.headers=a.headers||{};var b=c.sessionStorage.token;return b&&(a.headers.Authorization="Bearer "+b),a},response:function(a){return 401===a.status&&console.log(a),a||b.when(a)}}}]),WobenCommon.factory("oDataInterceptor",["$q",function(a){var b=function(a){var c={};for(prop in a){var d=prop.charAt(0).toLowerCase()+prop.slice(1);angular.isArray(a[prop])?(c[d]=[],angular.forEach(a[prop],function(a){var b={};for(subprop in a){var e=subprop.charAt(0).toLowerCase()+subprop.slice(1);b[e]=a[subprop]}c[d].push(b)})):c[d]=angular.isObject(a[prop])?b(a[prop]):a[prop]}return c},c=function(a){return-1!=a["odata.metadata"].indexOf("$metadata#Category")||-1!=a["odata.metadata"].indexOf("$metadata#Product")||-1!=a["odata.metadata"].indexOf("$metadata#Notification")||-1!=a["odata.metadata"].indexOf("$metadata#Message")?a.value?(oDataArray=[],angular.forEach(a.value,function(a){oDataArray.push(b(a))}),oDataArray):b(a):response};return{response:function(a){if("application/json; charset=utf-8"===a.headers()["content-type"]){var b=null;if(a.data["odata.metadata"])var b=c(a.data);b&&(a.data=b)}return a},responseError:function(b){return a.reject(b)}}}]),WobenCommon.factory("errorService",function(){return{handleValidationErrors:function(a){var b=[];if(a&&a.message){if(a.modelState)for(var c in a.modelState)b.push(a.modelState[c][0]);return{message:a.message,errors:b}}},handleAuthenticationErrors:function(a){return{message:a.error,errors:new Array(a.error_description)}},handleODataErrors:function(a){var b=a["odata.error"],c=[];if(b){if(b.innererror)for(var d=b.innererror.message.split("."),e=0;e<d.length;e++)c.push(-1!=d[e].indexOf(":")?d[e].split(":")[1]:d[e]);return{message:b.message.value,errors:c}}}}}),WobenCommon.directive("woOffcanvas",["$window",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{activeTransitions:"@",noAdditional:"@",noMenu:"@"},controller:["$scope",function(b){b.windowWidth=a.innerWidth,b.activeMenu=!1,b.activeAdditional=!1,this.toggleMenu=function(){b.windowWidth<768?b.activeMenu=!b.activeMenu:b.windowWidth>=768&&b.windowWidth<978?b.activeMenu=!1:(b.activeMenu=!1,b.activeAdditional=!1)},this.toggleAdditional=function(){b.windowWidth<768?b.activeAdditional=!b.activeAdditional:b.windowWidth>=768&&b.windowWidth<978?b.activeAdditional=!b.activeAdditional:(b.activeMenu=!1,b.activeAdditional=!1)},b.getWidth=function(){return a.innerWidth},b.$watch(b.getWidth,function(a){b.windowWidth=a}),window.onresize=function(){b.$apply()}}],template:'<div class="st-offcanvas" ng-class="{activemenu : activeMenu, activeadditional : activeAdditional }" ng-transclude></div>',link:function(a,b){"true"==a.activeTransitions&&b.addClass("active-transitions"),"true"==a.noAdditional&&b.addClass("no-additional"),"true"==a.noMenu&&b.addClass("no-menu")}}}]),WobenCommon.directive("woOffcanvasMenu",function(){return{restrict:"E",replace:!0,require:"^woOffcanvas",transclude:!0,template:'<div class="st-offcanvas-menu" ng-transclude></div>',link:function(a,b,c,d){$(b).on("click",function(){d.toggleMenu()})}}}),WobenCommon.directive("woOffcanvasMain",["$window",function(a){return{restrict:"E",replace:!0,transclude:!0,require:"^woOffcanvas",template:'<div class="st-offcanvas-main"><div class="container-fluid buttonsContainer"><a href="javascript:;" class="showmenubutton" ng-show="visibleMenu" ng-click="toggleMenu()"><span class="fui-list"></span></a></div><div ng-transclude></div></div>',controller:["$scope",function(b){b.windowWidth=a.innerWidth,b.getWidth=function(){return a.innerWidth},b.$watch(b.getWidth,function(a){b.windowWidth=a}),a.onresize=function(){b.$apply(),c(),d()};var c=function(){var a=angular.element(".st-offcanvas-menu").height(),b=angular.element(window).height()-angular.element("footer").height();a>b&&(b=a+20),angular.element(".st-offcanvas-main").css("min-height",b)},d=function(){b.windowWidth<768?(b.visibleMenu=!0,b.visibleAdditional=!0):b.windowWidth>=768&&b.windowWidth<978?(b.visibleMenu=!1,b.visibleAdditional=!0):(b.visibleMenu=!1,b.visibleAdditional=!1)};b.$on("woben:loaderhide",function(){c()}),d()}],link:function(a,b,c,d){a.toggleMenu=d.toggleMenu,a.toggleAdditional=d.toggleAdditional}}}]),WobenCommon.directive("woOffcanvasAdditional",function(){return{restrict:"E",replace:!0,transclude:!0,require:"^woOffcanvas",template:'<div  class="st-offcanvas-additional" ng-transclude></div>'}}),WobenCommon.factory("utilsService",function(){return{groupToPages:function(a,b){for(var c=[],d=0;d<a.length;d++)d%b===0?c[Math.floor(d/b)]=[a[d]]:c[Math.floor(d/b)].push(a[d]);return c},addDummyProduct:function(a){var b=a.length;b%3==2&&a.push({categoryId:Number.MAX_VALUE,dummy:!0})}}}),WobenCommon.directive("woFileUpload",["baseEndPoint","$window",function(a){return{link:function(a,b,c){c.maxFiles&&1==parseInt(c.maxFiles)||angular.element(b).find("input[type=file]").attr("multiple","multiple")},restrict:"E",replace:!0,scope:{selectText:"@",updateText:"@",deleteText:"@",mode:"@",maxFiles:"@",uploadRightAway:"@",ngModel:"="},controller:["$scope","$http","$timeout","$upload",function(b,c,d,e){b.fileReaderSupported=null!=window.FileReader,b.changeAngularVersion=function(){window.location.hash=b.angularVersion,window.location.reload(!0)},b.hasUploader=function(a){return null!=b.upload[a]},b.abort=function(a){b.upload[a].abort(),b.upload[a]=null},b.angularVersion=window.location.hash.length>1?window.location.hash.substring(1):"1.2.0",b.onFileSelect=function(a){if(b.selectedFiles=[],b.progress=[],b.upload&&b.upload.length>0)for(var c=0;c<b.upload.length;c++)null!=b.upload[c]&&b.upload[c].abort();b.upload=[],b.uploadResult=[],b.selectedFiles=a,b.dataUrls=[];for(var c=0;c<a.length;c++){var e=a[c];if(window.FileReader&&e.type.indexOf("image")>-1){var f=new FileReader;f.readAsDataURL(a[c]);{(function(a,c){a.onload=function(a){d(function(){b.dataUrls[c]=a.target.result})}})(f,c)}}b.progress[c]=-1,b.uploadRightAway&&"true"==b.uploadRightAway&&b.start(c)}},b.start=function(c){if(b.progress[c]=0,b.maxFiles&&angular.element("input[type=file]")[0].files.length>parseInt(b.maxFiles),"multipart"==b.mode)b.upload[c]=e.upload({url:a+"/api/file",method:"POST",headers:{"my-header":"my-header-value"},file:b.selectedFiles[c],fileFormDataName:"myFile"}).then(function(a){b.uploadResult.push(a.data[c]),b.ngModel=b.uploadResult},null,function(a){b.progress[c]=parseInt(100*a.loaded/a.total)}).xhr(function(a){a.upload.addEventListener("abort",function(){console.log("aborted complete")},!1)});else{var d=new FileReader;d.onload=function(d){b.upload[c]=e.http({url:a+"/api/file",headers:{"Content-Type":b.selectedFiles[c].type},data:d.target.result}).then(function(a){b.uploadResult.push(a.data[c]),b.ngModel=a.data,b.ngModel=b.uploadResult},null,function(a){b.progress[c]=Math.min(100,parseInt(100*a.loaded/a.total))})},d.readAsArrayBuffer(b.selectedFiles[c])}}}],templateUrl:"/app/templates/common/fileUploadDirective.html"}}]),WobenCommon.directive("woLoader",["$rootScope",function(){return{link:function(a,b){return a.$on("woben:loadershow",function(){return b.show()}),a.$on("woben:loaderhide",function(){return b.hide()})},restrict:"E",replace:!0,templateUrl:"/app/templates/common/loaderDirective.html"}}]),WobenCommon.factory("loaderInterceptor",["$q","$rootScope","$log",function(a,b){var c=0;return{request:function(d){return c++,b.$broadcast("woben:loadershow"),d||a.when(d)},response:function(d){return 0===--c&&b.$broadcast("woben:loaderhide"),d||a.when(d)},responseError:function(d){return--c||b.$broadcast("woben:loaderhide"),a.reject(d)}}}]),WobenCommon.directive("woSelect",function(){return{link:function(a,b){angular.element(b).selectpicker({style:"btn-primary",menuStyle:"dropdown-inverse"})},restrict:"E",replace:!0,scope:{title:"@",value:"@",description:"@",options:"=",ngModel:"="},templateUrl:"/app/templates/common/selectDirective.html"}}),WobenCommon.directive("woTypeahead",function(){return{restrict:"AC",require:"?ngModel",scope:{options:"=",datasets:"="},link:function(a,b,c,d){function e(a,b){var c=-1;return angular.forEach(a,function(a,d){angular.equals(b,a)&&(c=d)}),c>=0}function f(a){var b=0;if(a=a[0],document.selection){var c=document.selection.createRange();c.moveStart("character",-a.value.length),b=c.text.length}else"number"==typeof a.selectionStart&&(b=a.selectionStart);return b}function g(a,b){if(a=a[0],document.selection){var c=a.createTextRange();c.move("character",b),c.select()}else"number"==typeof a.selectionStart&&(a.focus(),a.setSelectionRange(b,b))}function h(b,c){a.$apply(function(){d.$setViewValue(c)})}var i=a.options||{},j=(angular.isArray(a.datasets)?a.datasets:[a.datasets])||[];b.typeahead(a.options,a.datasets),d.$parsers.push(function(a){var b=angular.isObject(a);return i.editable===!1?(d.$setValidity("typeahead",b),b?a:void 0):a}),d.$formatters.push(function(c){if(angular.isObject(c)){var f=!1;return $.each(j,function(g,h){function k(h){var k=e(h,c);k?(d.$setViewValue(c),f=!0):d.$setViewValue(i.editable===!1?void 0:c),(f||g===j.length-1)&&setTimeout(function(){a.$apply(function(){b.typeahead("val",n)})},0)}var l=h.source,m=h.displayKey||"value",n=(angular.isFunction(m)?m(c):c[m])||"";return f?!1:n?void l(n,k):void k([])}),""}return c}),b.bind("typeahead:selected",function(b,c,d){h(b,c,d),a.$emit("typeahead:selected",c,d)}),b.bind("typeahead:autocompleted",function(b,c,d){h(b,c,d),a.$emit("typeahead:autocompleted",c,d)}),b.bind("typeahead:opened",function(){a.$emit("typeahead:opened")}),b.bind("typeahead:closed",function(){a.$emit("typeahead:closed")}),b.bind("typeahead:cursorchanged",function(b,c,d){a.$emit("typeahead:cursorchanged",b,c,d)}),b.bind("input",function(){var c=f(b);a.$apply(function(){var a=b.typeahead("val");d.$setViewValue(a)}),g(b,c)})}}});